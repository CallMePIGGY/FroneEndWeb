<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>Jasmine & Karma 单元测试工具</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="6z5r" id="jasmine-karma-单元测试工具">Jasmine &amp; Karma 单元测试工具</h1><hr><p data-anchor-id="aixg">在软件工程领域，行为驱动开发（Bahavior Driven Development，BDD）是从测试驱动开发（Test Driven Development，TDD）中产生的一种软件开发过程。行为驱动开发结合了测试驱动开发在领域驱动设计和面向对象的分析与设计中的一般技术和原则，提供软件开发和管理团队共享工具来协调软件开发过程。</p><div class="md-section-divider"></div><h2 data-anchor-id="xcj9" id="jasmine">Jasmine</h2><p data-anchor-id="y6c2"><strong>Jasmine</strong> 就是一款针对JavaScript语言的行为驱动测试开发测试框架，它不依赖与浏览器、DOM以及其他JavaScript框架。因此它适用于网页、Node.js项目以及其他JavaScript运行环境。</p><p data-anchor-id="o7dt">Jasmine官方网站地址为：<a href="http://jasmine.github.io/" target="_blank">http://jasmine.github.io/</a> <br>
Jasmine源代码地址为：<a href="http://github.com/jasmine/jasmine" target="_blank">http://github.com/jasmine/jasmine</a></p><div class="md-section-divider"></div><h2 data-anchor-id="50i6" id="karma">Karma</h2><p data-anchor-id="f1bk"><strong>Karma</strong> 是一款基于Node.js的JavaScript测试执行过程管理工具（Test Runner），允许我们在多个真实的浏览器中执行JavaScript代码，它的宗旨是让测试驱动开发变得简单、快捷和有趣。</p><p data-anchor-id="9n2u">Karma官方网站地址为：<a href="http://karma-runner.github.io/" target="_blank">http://karma-runner.github.io/</a> <br>
Karma源代码地址为：<a href="http://github.com/jasmine/jasmine" target="_blank">http://github.com/karma-runner/karma</a></p><div class="md-section-divider"></div><h1 data-anchor-id="jlyf" id="安装jasmine">安装Jasmine</h1><hr><p data-anchor-id="g13k"><strong>Jasmine</strong> 提供了基于Node.js的允许环境，可以作为命令工具使用，安装过程比较简单，需要借助Npm包管理工具，安装命令如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="tihd"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">npm install </span><span class="pun">-</span><span class="pln">gd jasmine</span></code></li></ol></pre><p data-anchor-id="rwne">安装完毕后，我们可以通过如下命令确定是否安装成功：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="m3x8"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">jasmine help</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="1318" id="使用jasmine进行单元测试">使用Jasmine进行单元测试</h2><hr><p data-anchor-id="hkpg">安装 <strong>Jasmine</strong> 后，我们就可以使用Jasmine对JavaScript代码进行单元测试了。首先需要进去项目根目录，通过 <strong>Jasmine</strong> 命令初始化项目，命令如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="98pe"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">jasmine init</span></code></li></ol></pre><p data-anchor-id="48hh">命令执行完毕后会在spec\support下生成一个jasmine.json，该文件用于描述 <strong>Jasmine</strong>  的配置信息，内容如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="7j96"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="str">"spec_dir"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"spec"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"><span class="pln">  </span><span class="str">"spec_files"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L3"><code class="language-python"><span class="pln">    </span><span class="str">"**/*[sS]pec.js"</span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="pun">],</span></code></li><li class="L5"><code class="language-python"><span class="pln">  </span><span class="str">"helpers"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L6"><code class="language-python"><span class="pln">    </span><span class="str">"helpers/**/*.js"</span></code></li><li class="L7"><code class="language-python"><span class="pln">  </span><span class="pun">],</span></code></li><li class="L8"><code class="language-python"><span class="pln">  </span><span class="str">"stopSpecOnExpectationFailure"</span><span class="pun">:</span><span class="pln"> false</span><span class="pun">,</span></code></li><li class="L9"><code class="language-python"><span class="pln">  </span><span class="str">"random"</span><span class="pun">:</span><span class="pln"> false</span></code></li><li class="L0"><code class="language-python"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="b3dm">接下来我们可以执行如下命令生成一个 <strong>Jasmine</strong> 官方提供的使用案例：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="xnfg"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">jasmine examples</span></code></li></ol></pre><p data-anchor-id="zagf">上面的命令执行完毕会生成如下文件及目录结构：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="rlbu"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">根目录</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="pun">|———</span><span class="pln">lib</span></code></li><li class="L2"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">    </span><span class="pun">|———</span><span class="pln">jasmine_examples</span></code></li><li class="L3"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">                </span><span class="pun">|———</span><span class="typ">Player</span><span class="pun">.</span><span class="pln">js</span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">                </span><span class="pun">|———</span><span class="typ">Song</span><span class="pun">.</span><span class="pln">js</span></code></li><li class="L5"><code class="language-python"><span class="pln">  </span><span class="pun">|</span></code></li><li class="L6"><code class="language-python"><span class="pln">  </span><span class="pun">|———</span><span class="pln">spec</span></code></li><li class="L7"><code class="language-python"><span class="pln">       </span><span class="pun">|———</span><span class="pln">helpers</span></code></li><li class="L8"><code class="language-python"><span class="pln">              </span><span class="pun">|———</span><span class="pln">jasmine_examples</span></code></li><li class="L9"><code class="language-python"><span class="pln">                  </span><span class="pun">|———</span><span class="typ">SpecHelper</span><span class="pun">.</span><span class="pln">js</span></code></li><li class="L0"><code class="language-python"></code></li><li class="L1"><code class="language-python"><span class="pln">       </span><span class="pun">|———</span><span class="pln">jasmine_examples</span></code></li><li class="L2"><code class="language-python"><span class="pln">                  </span><span class="pun">|———</span><span class="typ">PlayerSpec</span><span class="pun">.</span><span class="pln">js</span></code></li><li class="L3"><code class="language-python"></code></li><li class="L4"><code class="language-python"><span class="pln">       </span><span class="pun">|———</span><span class="pln">support</span></code></li><li class="L5"><code class="language-python"><span class="pln">              </span><span class="pun">|———</span><span class="pln">jasmine</span><span class="pun">.</span><span class="pln">json</span></code></li></ol></pre><p data-anchor-id="ihe0">上面的文件结构构成了一个完整的 <strong>Jasmine</strong> 框架使用案例，其中Player.js和Song.js文件为需要测试的JavaScript代码，我们需要重点关注的是PlayerSpec.js文件，该文件中为 <strong>Jasmine</strong> 框架使用案例代码，内容如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ptvl"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">describe</span><span class="pun">(</span><span class="str">"Player"</span><span class="pun">,</span><span class="pln"> function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">  var </span><span class="typ">Player</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'../../lib/jasmine_examples/Player'</span><span class="pun">);</span></code></li><li class="L2"><code class="language-python"><span class="pln">  var </span><span class="typ">Song</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'../../lib/jasmine_examples/Song'</span><span class="pun">);</span></code></li><li class="L3"><code class="language-python"><span class="pln">  var player</span><span class="pun">;</span></code></li><li class="L4"><code class="language-python"><span class="pln">  var song</span><span class="pun">;</span></code></li><li class="L5"><code class="language-python"></code></li><li class="L6"><code class="language-python"><span class="pln">  beforeEach</span><span class="pun">(</span><span class="pln">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-python"><span class="pln">    player </span><span class="pun">=</span><span class="pln"> new </span><span class="typ">Player</span><span class="pun">();</span></code></li><li class="L8"><code class="language-python"><span class="pln">    song </span><span class="pun">=</span><span class="pln"> new </span><span class="typ">Song</span><span class="pun">();</span></code></li><li class="L9"><code class="language-python"><span class="pln">  </span><span class="pun">});</span></code></li><li class="L0"><code class="language-python"></code></li><li class="L1"><code class="language-python"><span class="pln">  it</span><span class="pun">(</span><span class="str">"should be able to play a Song"</span><span class="pun">,</span><span class="pln"> function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-python"><span class="pln">    player</span><span class="pun">.</span><span class="pln">play</span><span class="pun">(</span><span class="pln">song</span><span class="pun">);</span></code></li><li class="L3"><code class="language-python"><span class="pln">    expect</span><span class="pun">(</span><span class="pln">player</span><span class="pun">.</span><span class="pln">currentlyPlayingSong</span><span class="pun">).</span><span class="pln">toEqual</span><span class="pun">(</span><span class="pln">song</span><span class="pun">);</span></code></li><li class="L4"><code class="language-python"></code></li><li class="L5"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln">demonstrates use of custom matcher</span></code></li><li class="L6"><code class="language-python"><span class="pln">    expect</span><span class="pun">(</span><span class="pln">player</span><span class="pun">).</span><span class="pln">toBePlaying</span><span class="pun">(</span><span class="pln">song</span><span class="pun">);</span></code></li><li class="L7"><code class="language-python"><span class="pln">  </span><span class="pun">});</span></code></li><li class="L8"><code class="language-python"></code></li><li class="L9"><code class="language-python"><span class="pln">  describe</span><span class="pun">(</span><span class="str">"when song has been paused"</span><span class="pun">,</span><span class="pln"> function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="language-python"><span class="pln">    beforeEach</span><span class="pun">(</span><span class="pln">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">      player</span><span class="pun">.</span><span class="pln">play</span><span class="pun">(</span><span class="pln">song</span><span class="pun">);</span></code></li><li class="L2"><code class="language-python"><span class="pln">      player</span><span class="pun">.</span><span class="pln">pause</span><span class="pun">();</span></code></li><li class="L3"><code class="language-python"><span class="pln">    </span><span class="pun">});</span></code></li><li class="L4"><code class="language-python"></code></li><li class="L5"><code class="language-python"><span class="pln">    it</span><span class="pun">(</span><span class="str">"should indicate that the song is currently paused"</span><span class="pun">,</span><span class="pln"> function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="language-python"><span class="pln">      expect</span><span class="pun">(</span><span class="pln">player</span><span class="pun">.</span><span class="pln">isPlaying</span><span class="pun">).</span><span class="pln">toBeFalsy</span><span class="pun">();</span></code></li><li class="L7"><code class="language-python"></code></li><li class="L8"><code class="language-python"><span class="pln">      </span><span class="pun">//</span><span class="pln">demonstrates use of </span><span class="str">'not'</span><span class="pln"> </span><span class="kwd">with</span><span class="pln"> a custom matcher</span></code></li><li class="L9"><code class="language-python"><span class="pln">      expect</span><span class="pun">(</span><span class="pln">player</span><span class="pun">).</span><span class="kwd">not</span><span class="pun">.</span><span class="pln">toBePlaying</span><span class="pun">(</span><span class="pln">song</span><span class="pun">);</span></code></li><li class="L0"><code class="language-python"><span class="pln">    </span><span class="pun">});</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="pln">    it</span><span class="pun">(</span><span class="str">"should be possible to resume"</span><span class="pun">,</span><span class="pln"> function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="language-python"><span class="pln">      player</span><span class="pun">.</span><span class="pln">resume</span><span class="pun">();</span></code></li><li class="L4"><code class="language-python"><span class="pln">      expect</span><span class="pun">(</span><span class="pln">player</span><span class="pun">.</span><span class="pln">isPlaying</span><span class="pun">).</span><span class="pln">toBeTruthy</span><span class="pun">();</span></code></li><li class="L5"><code class="language-python"><span class="pln">      expect</span><span class="pun">(</span><span class="pln">player</span><span class="pun">.</span><span class="pln">currentlyPlayingSong</span><span class="pun">).</span><span class="pln">toEqual</span><span class="pun">(</span><span class="pln">song</span><span class="pun">);</span></code></li><li class="L6"><code class="language-python"><span class="pln">    </span><span class="pun">});</span></code></li><li class="L7"><code class="language-python"><span class="pln">  </span><span class="pun">});</span></code></li><li class="L8"><code class="language-python"></code></li><li class="L9"><code class="language-python"><span class="pln">  </span><span class="pun">//</span><span class="pln">demonstrates use of spies to intercept </span><span class="kwd">and</span><span class="pln"> test method calls</span></code></li><li class="L0"><code class="language-python"><span class="pln">  it</span><span class="pun">(</span><span class="str">"tells the current song if the user has made it a favorite"</span><span class="pun">,</span><span class="pln"> function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">    spyOn</span><span class="pun">(</span><span class="pln">song</span><span class="pun">,</span><span class="pln"> </span><span class="str">'persistFavoriteStatus'</span><span class="pun">);</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"><span class="pln">    player</span><span class="pun">.</span><span class="pln">play</span><span class="pun">(</span><span class="pln">song</span><span class="pun">);</span></code></li><li class="L4"><code class="language-python"><span class="pln">    player</span><span class="pun">.</span><span class="pln">makeFavorite</span><span class="pun">();</span></code></li><li class="L5"><code class="language-python"></code></li><li class="L6"><code class="language-python"><span class="pln">    expect</span><span class="pun">(</span><span class="pln">song</span><span class="pun">.</span><span class="pln">persistFavoriteStatus</span><span class="pun">).</span><span class="pln">toHaveBeenCalledWith</span><span class="pun">(</span><span class="pln">true</span><span class="pun">);</span></code></li><li class="L7"><code class="language-python"><span class="pln">  </span><span class="pun">});</span></code></li><li class="L8"><code class="language-python"></code></li><li class="L9"><code class="language-python"><span class="pln">  </span><span class="pun">//</span><span class="pln">demonstrates use of expected exceptions</span></code></li><li class="L0"><code class="language-python"><span class="pln">  describe</span><span class="pun">(</span><span class="str">"#resume"</span><span class="pun">,</span><span class="pln"> function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">    it</span><span class="pun">(</span><span class="str">"should throw an exception if song is already playing"</span><span class="pun">,</span><span class="pln"> function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-python"><span class="pln">      player</span><span class="pun">.</span><span class="pln">play</span><span class="pun">(</span><span class="pln">song</span><span class="pun">);</span></code></li><li class="L3"><code class="language-python"></code></li><li class="L4"><code class="language-python"><span class="pln">      expect</span><span class="pun">(</span><span class="pln">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="language-python"><span class="pln">        player</span><span class="pun">.</span><span class="pln">resume</span><span class="pun">();</span></code></li><li class="L6"><code class="language-python"><span class="pln">      </span><span class="pun">}).</span><span class="pln">toThrowError</span><span class="pun">(</span><span class="str">"song is already playing"</span><span class="pun">);</span></code></li><li class="L7"><code class="language-python"><span class="pln">    </span><span class="pun">});</span></code></li><li class="L8"><code class="language-python"><span class="pln">  </span><span class="pun">});</span></code></li><li class="L9"><code class="language-python"><span class="pun">});</span></code></li></ol></pre><p data-anchor-id="ldrk">如上面所示，我们先来简单地了解一些 <strong>Jasmine</strong> 的基本语法：</p><ol data-anchor-id="qq75">
<li><p>describe(string,function)方法可以理解为一个测试集或者测试包（官方称之为suite），主要功能是用来划分单元测试。需要注意的是，describe(string,function)方法是可以嵌套使用的。 <br>
第一个参数string为字符串类型，用于描述测试包的信息。 <br>
第二个参数function为一个方法，可以在该方法中编写测试集的具体实现，可包含任意代码。</p></li>
<li><p>it(string,function)方法用于定义一个具体测试用例。 <br>
第一个参数string用于描述测试用例的信息 <br>
在第二个参数function中可以编写具体测试用例代码。</p></li>
<li><p>expect()方法为断言表达式，主要用于判断表达式的值和期待的值是否相等，所有的匹配模式方法如下：</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">toBe</span><span class="pun">()</span></code></li><li class="L1"><code class="language-python"><span class="pln">toBeDefined</span><span class="pun">()</span></code></li><li class="L2"><code class="language-python"><span class="pln">toBeUndefined</span><span class="pun">()</span></code></li><li class="L3"><code class="language-python"><span class="pln">toBeNull</span><span class="pun">()</span></code></li><li class="L4"><code class="language-python"><span class="pln">toBeTruthy</span><span class="pun">()</span></code></li><li class="L5"><code class="language-python"><span class="pln">toBeFalsy</span><span class="pun">()</span></code></li><li class="L6"><code class="language-python"><span class="pln">toEqual</span><span class="pun">()</span></code></li><li class="L7"><code class="language-python"><span class="pln">toBeLessThan</span><span class="pun">()</span></code></li><li class="L8"><code class="language-python"><span class="pln">toBeGreaterThan</span><span class="pun">()</span></code></li><li class="L9"><code class="language-python"><span class="pln">toContain</span><span class="pun">()</span></code></li><li class="L0"><code class="language-python"><span class="pln">toBeCloseTo</span><span class="pun">()</span></code></li><li class="L1"><code class="language-python"><span class="pln">toHaveBeenCalled</span><span class="pun">()</span></code></li><li class="L2"><code class="language-python"><span class="pln">toHaveBeenCalledWith</span><span class="pun">()</span></code></li><li class="L3"><code class="language-python"><span class="pln">toMatch</span><span class="pun">()</span></code></li><li class="L4"><code class="language-python"><span class="pln">toThrow</span><span class="pun">()</span></code></li></ol></pre>

<p>从方法名称上就可以看出它们的含义，下面是一些使用案例：</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">expect</span><span class="pun">(</span><span class="pln">a</span><span class="pun">).</span><span class="pln">toBe</span><span class="pun">(</span><span class="pln">true</span><span class="pun">);</span><span class="pln">                      </span><span class="pun">//期望变量</span><span class="pln">a</span><span class="pun">为</span><span class="pln">true</span></code></li><li class="L1"><code class="language-python"><span class="pln">expect</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">foo</span><span class="pun">).</span><span class="pln">toBeDefined</span><span class="pun">();</span><span class="pln">               </span><span class="pun">//期望</span><span class="pln">a</span><span class="pun">.</span><span class="pln">foo</span><span class="pun">已定义</span></code></li><li class="L2"><code class="language-python"><span class="pln">expect</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">foo</span><span class="pun">).</span><span class="pln">toBeUndefined</span><span class="pun">();</span><span class="pln">             </span><span class="pun">//期望</span><span class="pln">a</span><span class="pun">.</span><span class="pln">foo</span><span class="pun">未定义</span></code></li><li class="L3"><code class="language-python"><span class="pln">expect</span><span class="pun">(</span><span class="pln">a</span><span class="pun">).</span><span class="pln">toBeNull</span><span class="pun">();</span><span class="pln">                      </span><span class="pun">//期望变量</span><span class="pln">a</span><span class="pun">为</span><span class="pln">null</span></code></li><li class="L4"><code class="language-python"><span class="pln">expect</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">isMale</span><span class="pun">).</span><span class="pln">toBeTruthy</span><span class="pun">();</span><span class="pln">             </span><span class="pun">//期望</span><span class="pln">a</span><span class="pun">.</span><span class="pln">isMale</span><span class="pun">为真</span></code></li><li class="L5"><code class="language-python"><span class="pln">expect</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">isMale</span><span class="pun">).</span><span class="pln">toBeFalsy</span><span class="pun">();</span><span class="pln">              </span><span class="pun">//期望</span><span class="pln">a</span><span class="pun">.</span><span class="pln">isMale</span><span class="pun">为假</span></code></li><li class="L6"><code class="language-python"><span class="pln">expect</span><span class="pun">(</span><span class="pln">true</span><span class="pun">).</span><span class="pln">toEqual</span><span class="pun">(</span><span class="pln">true</span><span class="pun">);</span><span class="pln">                </span><span class="pun">//期望</span><span class="pln">true</span><span class="pun">等于</span><span class="pln">true</span></code></li><li class="L7"><code class="language-python"><span class="pln">expect</span><span class="pun">(</span><span class="pln">a</span><span class="pun">).</span><span class="pln">toBeLessThan</span><span class="pun">(</span><span class="pln">b</span><span class="pun">);</span><span class="pln">                 </span><span class="pun">//期望</span><span class="pln">a</span><span class="pun">小于</span><span class="pln">b</span></code></li><li class="L8"><code class="language-python"><span class="pln">expect</span><span class="pun">(</span><span class="pln">a</span><span class="pun">).</span><span class="pln">toBeGreaterThan</span><span class="pun">(</span><span class="pln">b</span><span class="pun">);</span><span class="pln">              </span><span class="pun">//期望</span><span class="pln">a</span><span class="pun">大于</span><span class="pln">b</span></code></li></ol></pre></li>
<li><p>beforeEach(function)方法主要用于在执行代买之前做一些操作，接收一个方法作为参数。我们可以通过beforeEach()执行一些初始化操作。与beforeEach()方法对应的还有一个afterEach(function)方法，用于在单元测试任务执行完毕后做一些操作，例如输出一些日志信息。</p></li>
</ol><p data-anchor-id="5nw2">有了测试用例代码后，我们可以在控制台中通过如下命令执行单元测试：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="h68n"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">jasmine</span></code></li></ol></pre><p data-anchor-id="qqwm">单元测试执行完毕后，控制台输出信息如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="sujv"><ol class="linenums"><li class="L0"><code class="language-python"><span class="typ">Started</span></code></li><li class="L1"><code class="language-python"><span class="pun">.....</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"></code></li><li class="L4"><code class="language-python"><span class="lit">5</span><span class="pln"> specs</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> failures</span></code></li><li class="L5"><code class="language-python"><span class="typ">Finished</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.011</span><span class="pln"> seconds</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="x2yq" id="在浏览器环境下使用jasmine">在浏览器环境下使用Jasmine</h2><p data-anchor-id="nsw1">上述是在Node.js环境下基于控制台命令实现JavaScript代码的单元测试，需要注意的是，<strong>Jasmine</strong> 框架并不依赖于Node.js，我们同样可以在浏览器环境下使用 <strong>Jasmine</strong> 框架完成JavaScript代码的单元测试。</p><p data-anchor-id="62sz">首先需要获取 <strong>Jasmine</strong> 框架库文件，可以从如下地址获取Release版本：</p><p data-anchor-id="5ja5"><a href="http://github.com/jasmine/jasmine/releases" target="_blank">http://github.com/jasmine/jasmine/releases</a></p><p data-anchor-id="sal3">下载完毕后进行解压，目录结果如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="d74x"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">根目录</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="pun">|———</span><span class="pln">MIT</span><span class="pun">.</span><span class="pln">LICENSE</span></code></li><li class="L2"><code class="language-python"><span class="pln">  </span><span class="pun">|</span></code></li><li class="L3"><code class="language-python"><span class="pln">  </span><span class="pun">|———</span><span class="typ">SpecRunner</span><span class="pun">.</span><span class="pln">html</span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="pun">|</span></code></li><li class="L5"><code class="language-python"><span class="pln">  </span><span class="pun">|———</span><span class="pln">lib</span></code></li><li class="L6"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">    </span><span class="pun">|———</span><span class="pln">jasmine</span><span class="pun">-</span><span class="lit">2.7</span><span class="pun">.</span><span class="lit">0</span><span class="pln"> </span></code></li><li class="L7"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">            </span><span class="pun">|———</span><span class="pln">boot</span><span class="pun">.</span><span class="pln">js</span></code></li><li class="L8"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">            </span><span class="pun">|———</span><span class="pln">console</span><span class="pun">.</span><span class="pln">js</span></code></li><li class="L9"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">            </span><span class="pun">|———</span><span class="pln">jasmine</span><span class="pun">-</span><span class="pln">html</span><span class="pun">.</span><span class="pln">js</span></code></li><li class="L0"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">            </span><span class="pun">|———</span><span class="pln">jasmine</span><span class="pun">.</span><span class="pln">css</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">            </span><span class="pun">|———</span><span class="pln">jasmine</span><span class="pun">.</span><span class="pln">js</span></code></li><li class="L2"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">            </span><span class="pun">|———</span><span class="pln">jasmine_favicon</span><span class="pun">.</span><span class="pln">png</span></code></li><li class="L3"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">            </span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="pun">|———</span><span class="pln">spec</span></code></li><li class="L5"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">    </span><span class="pun">|———</span><span class="typ">PlayerSpec</span><span class="pun">.</span><span class="pln">js</span></code></li><li class="L6"><code class="language-python"><span class="pln">  </span><span class="pun">|</span><span class="pln">    </span><span class="pun">|———</span><span class="typ">SpecHelper</span><span class="pun">.</span><span class="pln">js</span></code></li><li class="L7"><code class="language-python"><span class="pln">  </span><span class="pun">|</span></code></li><li class="L8"><code class="language-python"><span class="pln">  </span><span class="pun">|———</span><span class="pln">src</span></code></li><li class="L9"><code class="language-python"><span class="pln">       </span><span class="pun">|———</span><span class="typ">Player</span><span class="pun">.</span><span class="pln">js</span></code></li><li class="L0"><code class="language-python"><span class="pln">       </span><span class="pun">|———</span><span class="typ">Song</span><span class="pun">.</span><span class="pln">js</span></code></li></ol></pre><p data-anchor-id="a47c"><strong>Jasmine</strong> 框架的Release版本压缩包中提供了一个完整的案例：lib目录下为 <strong>Jasmine</strong> 框架的所有库文件，src目录下为需要测试的JavaScript代码，spec目录下为使用 <strong>Jasmine</strong> 框架编写的测试用例代码。</p><p data-anchor-id="14c8">SpecRunner.html文件演示了如何在浏览器中运行测试用例，内容如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="4jep"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">&lt;!</span><span class="pln">DOCTYPE html</span><span class="pun">&gt;</span></code></li><li class="L1"><code class="language-python"><span class="pun">&lt;</span><span class="pln">html</span><span class="pun">&gt;</span></code></li><li class="L2"><code class="language-python"><span class="pun">&lt;</span><span class="pln">head</span><span class="pun">&gt;</span></code></li><li class="L3"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">meta charset</span><span class="pun">=</span><span class="str">"utf-8"</span><span class="pun">&gt;</span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">title</span><span class="pun">&gt;</span><span class="typ">Jasmine</span><span class="pln"> </span><span class="typ">Spec</span><span class="pln"> </span><span class="typ">Runner</span><span class="pln"> v2</span><span class="pun">.</span><span class="lit">7.0</span><span class="pun">&lt;/</span><span class="pln">title</span><span class="pun">&gt;</span></code></li><li class="L5"><code class="language-python"></code></li><li class="L6"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">link rel</span><span class="pun">=</span><span class="str">"shortcut icon"</span><span class="pln"> type</span><span class="pun">=</span><span class="str">"image/png"</span><span class="pln"> href</span><span class="pun">=</span><span class="str">"lib/jasmine-2.7.0/jasmine_favicon.png"</span><span class="pun">&gt;</span></code></li><li class="L7"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">link rel</span><span class="pun">=</span><span class="str">"stylesheet"</span><span class="pln"> href</span><span class="pun">=</span><span class="str">"lib/jasmine-2.7.0/jasmine.css"</span><span class="pun">&gt;</span></code></li><li class="L8"><code class="language-python"></code></li><li class="L9"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">script src</span><span class="pun">=</span><span class="str">"lib/jasmine-2.7.0/jasmine.js"</span><span class="pun">&gt;&lt;/</span><span class="pln">script</span><span class="pun">&gt;</span></code></li><li class="L0"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">script src</span><span class="pun">=</span><span class="str">"lib/jasmine-2.7.0/jasmine-html.js"</span><span class="pun">&gt;&lt;/</span><span class="pln">script</span><span class="pun">&gt;</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">script src</span><span class="pun">=</span><span class="str">"lib/jasmine-2.7.0/boot.js"</span><span class="pun">&gt;&lt;/</span><span class="pln">script</span><span class="pun">&gt;</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;!--</span><span class="pln"> include source files here</span><span class="pun">...</span><span class="pln"> </span><span class="pun">--&gt;</span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">script src</span><span class="pun">=</span><span class="str">"src/Player.js"</span><span class="pun">&gt;&lt;/</span><span class="pln">script</span><span class="pun">&gt;</span></code></li><li class="L5"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">script src</span><span class="pun">=</span><span class="str">"src/Song.js"</span><span class="pun">&gt;&lt;/</span><span class="pln">script</span><span class="pun">&gt;</span></code></li><li class="L6"><code class="language-python"></code></li><li class="L7"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;!--</span><span class="pln"> include spec files here</span><span class="pun">...</span><span class="pln"> </span><span class="pun">--&gt;</span></code></li><li class="L8"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">script src</span><span class="pun">=</span><span class="str">"spec/SpecHelper.js"</span><span class="pun">&gt;&lt;/</span><span class="pln">script</span><span class="pun">&gt;</span></code></li><li class="L9"><code class="language-python"><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">script src</span><span class="pun">=</span><span class="str">"spec/PlayerSpec.js"</span><span class="pun">&gt;&lt;/</span><span class="pln">script</span><span class="pun">&gt;</span></code></li><li class="L0"><code class="language-python"></code></li><li class="L1"><code class="language-python"><span class="pun">&lt;/</span><span class="pln">head</span><span class="pun">&gt;</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"><span class="pun">&lt;</span><span class="pln">body</span><span class="pun">&gt;</span></code></li><li class="L4"><code class="language-python"><span class="pun">&lt;/</span><span class="pln">body</span><span class="pun">&gt;</span></code></li><li class="L5"><code class="language-python"><span class="pun">&lt;/</span><span class="pln">html</span><span class="pun">&gt;</span></code></li></ol></pre><p data-anchor-id="uczj">我们可以在浏览器中运行SpecRunner.html页面，如图所示：</p><p data-anchor-id="15jk"><img src="http://static.zybuluo.com/Iamxiaozhu/13677x8mf3ewkn9mxyjsck85/%E6%97%A0%E6%A0%87%E9%A2%98.png" alt="无标题.png-40.3kB" title=""></p><p data-anchor-id="ygj5">更多关于 <strong>Jasmine</strong> 框架的介绍及使用方法读者可参考如下内容：</p><ul data-anchor-id="74ll">
<li><a href="https://github.com/jasmine/jasmine" target="_blank">https://github.com/jasmine/jasmine</a></li>
<li><a href="http://jasmine.github.io/2.5/introduction.html" target="_blank">http://jasmine.github.io/2.5/introduction.html</a></li>
<li><a href="https://github.com/jasmine/jasmine/wiki" target="_blank">https://github.com/jasmine/jasmine/wiki</a></li>
</ul><div class="md-section-divider"></div><h1 data-anchor-id="53cg" id="安装并使用karma">安装并使用Karma</h1><hr><p data-anchor-id="tnwg">我们开始学习单元测试管理工具 <strong>karma</strong> 的安装与使用。安装过程比较简单，也需要借助Npm包管理工具，命令如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="0kkc"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">npm install karma </span><span class="pun">--</span><span class="pln">save</span><span class="pun">-</span><span class="pln">dev</span></code></li></ol></pre><p data-anchor-id="7rgi">另外，在使用 <strong>Karma</strong> 启动单元测试用例之前，还需要安装单元测试框架相关的插件，例如使用 <strong>Jasmine</strong> 框架进行单元测试时需要安装 <strong>karma-jasmine</strong> 插件，安装命令如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="bjr4"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">npm install karma</span><span class="pun">-</span><span class="pln">jasmine </span><span class="pun">--</span><span class="pln">save</span><span class="pun">-</span><span class="pln">dev</span></code></li></ol></pre><p data-anchor-id="9y3u">除此之外，我们还需要安装 <strong>Karma</strong> 的浏览器启动插件，例如使用Chrome浏览器运行测试用例就需要安装 <strong>karma-chrome-launcher</strong> 插件，安装命令如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ur81"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">npm install karma</span><span class="pun">-</span><span class="pln">chrome</span><span class="pun">-</span><span class="pln">launcher </span><span class="pun">--</span><span class="pln">save</span><span class="pun">-</span><span class="pln">dev</span></code></li></ol></pre><p data-anchor-id="mo7l">最后一步，安装 <strong>Karma</strong> 命令行工具，主要用于初始化 <strong>Karma</strong> 项目及启动单元测试用例，可以选择全局安装，命令如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="a8iz"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">npm install </span><span class="pun">-</span><span class="pln">g karma</span><span class="pun">-</span><span class="pln">cli</span></code></li></ol></pre><p data-anchor-id="jtjt">安装完毕后，可以通过 <strong>karma --help</strong> 命令查看是否安装成功。如果输出 <strong>karma</strong> 命令的帮助信息就说明安装成功。</p><p data-anchor-id="spff">接着我们可以使用 <strong>karma</strong> 命令行工具初始化一个 <strong>Karma</strong> 项目，命令如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="3eqb"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">karma init</span></code></li></ol></pre><p data-anchor-id="m0w0">在命令执行过程中会有一个向导要求输入 <strong>Karma</strong> 的配置信息，我们可以按 <strong>Enter</strong> 键保持默认，向导结束后会在工作目录下生成一个 <strong>karma.conf.js</strong> 文件。该文件即为 <strong>Karma</strong> 工具的配置信息，内容如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="sz1u"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">//</span><span class="pln"> </span><span class="typ">Karma</span><span class="pln"> configuration</span></code></li><li class="L1"><code class="language-python"><span class="pun">//</span><span class="pln"> </span><span class="typ">Generated</span><span class="pln"> on </span><span class="typ">Fri</span><span class="pln"> </span><span class="typ">Jul</span><span class="pln"> </span><span class="lit">07</span><span class="pln"> </span><span class="lit">2017</span><span class="pln"> </span><span class="lit">17</span><span class="pun">:</span><span class="lit">09</span><span class="pun">:</span><span class="lit">24</span><span class="pln"> GMT</span><span class="pun">+</span><span class="lit">0800</span><span class="pln"> </span><span class="pun">(中国标准时间)</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"><span class="pln">module</span><span class="pun">.</span><span class="pln">exports </span><span class="pun">=</span><span class="pln"> function</span><span class="pun">(</span><span class="pln">config</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-python"><span class="pln">  config</span><span class="pun">.</span><span class="pln">set</span><span class="pun">({</span></code></li><li class="L5"><code class="language-python"></code></li><li class="L6"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> base path that will be used to resolve all patterns </span><span class="pun">(</span><span class="pln">eg</span><span class="pun">.</span><span class="pln"> files</span><span class="pun">,</span><span class="pln"> exclude</span><span class="pun">)</span></code></li><li class="L7"><code class="language-python"><span class="pln">    basePath</span><span class="pun">:</span><span class="pln"> </span><span class="str">''</span><span class="pun">,</span></code></li><li class="L8"><code class="language-python"></code></li><li class="L9"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> frameworks to use</span></code></li><li class="L0"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> available frameworks</span><span class="pun">:</span><span class="pln"> https</span><span class="pun">://</span><span class="pln">npmjs</span><span class="pun">.</span><span class="pln">org</span><span class="pun">/</span><span class="pln">browse</span><span class="pun">/</span><span class="pln">keyword</span><span class="pun">/</span><span class="pln">karma</span><span class="pun">-</span><span class="pln">adapter</span></code></li><li class="L1"><code class="language-python"><span class="pln">    frameworks</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'jasmine'</span><span class="pun">],</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> list of files </span><span class="pun">/</span><span class="pln"> patterns to load </span><span class="kwd">in</span><span class="pln"> the browser</span></code></li><li class="L4"><code class="language-python"><span class="pln">    files</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L5"><code class="language-python"><span class="pln">    </span><span class="pun">],</span></code></li><li class="L6"><code class="language-python"></code></li><li class="L7"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> list of files to exclude</span></code></li><li class="L8"><code class="language-python"><span class="pln">    exclude</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L9"><code class="language-python"><span class="pln">    </span><span class="pun">],</span></code></li><li class="L0"><code class="language-python"></code></li><li class="L1"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> preprocess matching files before serving them to the browser</span></code></li><li class="L2"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> available preprocessors</span><span class="pun">:</span><span class="pln"> https</span><span class="pun">://</span><span class="pln">npmjs</span><span class="pun">.</span><span class="pln">org</span><span class="pun">/</span><span class="pln">browse</span><span class="pun">/</span><span class="pln">keyword</span><span class="pun">/</span><span class="pln">karma</span><span class="pun">-</span><span class="pln">preprocessor</span></code></li><li class="L3"><code class="language-python"><span class="pln">    preprocessors</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-python"><span class="pln">    </span><span class="pun">},</span></code></li><li class="L5"><code class="language-python"></code></li><li class="L6"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> test results reporter to use</span></code></li><li class="L7"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> possible values</span><span class="pun">:</span><span class="pln"> </span><span class="str">'dots'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'progress'</span></code></li><li class="L8"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> available reporters</span><span class="pun">:</span><span class="pln"> https</span><span class="pun">://</span><span class="pln">npmjs</span><span class="pun">.</span><span class="pln">org</span><span class="pun">/</span><span class="pln">browse</span><span class="pun">/</span><span class="pln">keyword</span><span class="pun">/</span><span class="pln">karma</span><span class="pun">-</span><span class="pln">reporter</span></code></li><li class="L9"><code class="language-python"><span class="pln">    reporters</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'progress'</span><span class="pun">],</span></code></li><li class="L0"><code class="language-python"></code></li><li class="L1"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> web server port</span></code></li><li class="L2"><code class="language-python"><span class="pln">    port</span><span class="pun">:</span><span class="pln"> </span><span class="lit">9876</span><span class="pun">,</span></code></li><li class="L3"><code class="language-python"></code></li><li class="L4"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> enable </span><span class="pun">/</span><span class="pln"> disable colors </span><span class="kwd">in</span><span class="pln"> the output </span><span class="pun">(</span><span class="pln">reporters </span><span class="kwd">and</span><span class="pln"> logs</span><span class="pun">)</span></code></li><li class="L5"><code class="language-python"><span class="pln">    colors</span><span class="pun">:</span><span class="pln"> true</span><span class="pun">,</span></code></li><li class="L6"><code class="language-python"></code></li><li class="L7"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> level of logging</span></code></li><li class="L8"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> possible values</span><span class="pun">:</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">LOG_DISABLE </span><span class="pun">||</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">LOG_ERROR </span><span class="pun">||</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">LOG_WARN </span><span class="pun">||</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">LOG_INFO</span></code></li><li class="L9"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">LOG_DEBUG</span></code></li><li class="L0"><code class="language-python"><span class="pln">    logLevel</span><span class="pun">:</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">LOG_INFO</span><span class="pun">,</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> enable </span><span class="pun">/</span><span class="pln"> disable watching file </span><span class="kwd">and</span><span class="pln"> executing tests whenever any file changes</span></code></li><li class="L3"><code class="language-python"><span class="pln">    autoWatch</span><span class="pun">:</span><span class="pln"> true</span><span class="pun">,</span></code></li><li class="L4"><code class="language-python"></code></li><li class="L5"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> start these browsers</span></code></li><li class="L6"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> available browser launchers</span><span class="pun">:</span><span class="pln"> https</span><span class="pun">://</span><span class="pln">npmjs</span><span class="pun">.</span><span class="pln">org</span><span class="pun">/</span><span class="pln">browse</span><span class="pun">/</span><span class="pln">keyword</span><span class="pun">/</span><span class="pln">karma</span><span class="pun">-</span><span class="pln">launcher</span></code></li><li class="L7"><code class="language-python"><span class="pln">    browsers</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Chrome'</span><span class="pun">],</span></code></li><li class="L8"><code class="language-python"></code></li><li class="L9"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> </span><span class="typ">Continuous</span><span class="pln"> </span><span class="typ">Integration</span><span class="pln"> mode</span></code></li><li class="L0"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> true</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Karma</span><span class="pln"> captures browsers</span><span class="pun">,</span><span class="pln"> runs the tests </span><span class="kwd">and</span><span class="pln"> exits</span></code></li><li class="L1"><code class="language-python"><span class="pln">    singleRun</span><span class="pun">:</span><span class="pln"> false</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> </span><span class="typ">Concurrency</span><span class="pln"> level</span></code></li><li class="L4"><code class="language-python"><span class="pln">    </span><span class="pun">//</span><span class="pln"> how many browser should be started simultaneous</span></code></li><li class="L5"><code class="language-python"><span class="pln">    concurrency</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Infinity</span></code></li><li class="L6"><code class="language-python"><span class="pln">  </span><span class="pun">})</span></code></li><li class="L7"><code class="language-python"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="vles">接下来我们通过 <strong>karma start</strong> 命令启动单元测试，<strong>Karma</strong> 启动后会以配置中指定的浏览器显示 <strong>Karma</strong> 的版本信息及连接状态，同时控制台中会输出单元测试结果。</p><p data-anchor-id="4e6c">浏览器： <br>
<img src="http://static.zybuluo.com/Iamxiaozhu/dxq3s8ygulp08rf5gav3me4k/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20170807154500.png" alt="微信截图_20170807154500.png-17.3kB" title=""></p><p data-anchor-id="vg2y">控制台： <br>
<img src="http://static.zybuluo.com/Iamxiaozhu/jkjl5uzfwjc83uzc5c1vk3xx/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20170807154422.png" alt="微信截图_20170807154422.png-53.6kB" title=""></p><div class="md-section-divider"></div><h1 data-anchor-id="v8y5" id="整合jasmine-karma">整合Jasmine &amp; Karma</h1><hr><p data-anchor-id="h8ss"><strong>Jaasmine</strong> 与 <strong>Karma</strong> 工具的作用各不相同，<strong>Jasmine</strong> 主要用于对代码进行单元测试，而 <strong>Karma</strong> 主要用于对单元测试进行管理（例如启动单元测试）。<strong>Jasmine</strong> 框架并不依赖于 <strong>Karma</strong> 工具，但是使用 <strong>Karma</strong> 能够更好地对所有测试用例进行集中管理，需要注意的是，<strong>Karma</strong> 除了能够整合 <strong>Jasmine</strong> 框架外，还能够与其他单元测试工具（例如Mocha、QUnit等框架）进行很好的整合。</p><p data-anchor-id="bk5b">首先打开控制台，进入项目根目录，通过npm init命令初始化项目，生成package.json文件，接着我们对该文件进行修改，在dependencies属性中添加所依赖的库文件，例如：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="akmg"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"test"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"><span class="pln">  </span><span class="str">"version"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1.0.0"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-python"><span class="pln">  </span><span class="str">"description"</span><span class="pun">:</span><span class="pln"> </span><span class="str">""</span><span class="pun">,</span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="str">"dependencies"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="language-python"><span class="pln">    </span><span class="str">"jasmine-core"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^2.5.0"</span><span class="pun">,</span></code></li><li class="L6"><code class="language-python"><span class="pln">    </span><span class="str">"karma-chrome-launcher"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^2.0.0"</span><span class="pun">,</span></code></li><li class="L7"><code class="language-python"><span class="pln">    </span><span class="str">"karma-jasmine"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^1.0.2"</span><span class="pun">,</span></code></li><li class="L8"><code class="language-python"><span class="pln">    </span><span class="str">"karma"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^1.2.0"</span></code></li><li class="L9"><code class="language-python"><span class="pln">  </span><span class="pun">},</span></code></li><li class="L0"><code class="language-python"><span class="pln">  </span><span class="str">"main"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"index.js"</span><span class="pun">,</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="str">"scripts"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-python"><span class="pln">    </span><span class="str">"test"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></code></li><li class="L3"><code class="language-python"><span class="pln">  </span><span class="pun">},</span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="str">"author"</span><span class="pun">:</span><span class="pln"> </span><span class="str">""</span><span class="pun">,</span></code></li><li class="L5"><code class="language-python"><span class="pln">  </span><span class="str">"license"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"ISC"</span></code></li><li class="L6"><code class="language-python"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="c2yv">如上面的配置信息所示，我们在dependencies属性中添加了使用 <strong>Jasmine</strong> 和 <strong>Karma</strong> 所有依赖的库文件：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="zwkx"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="str">"jasmine-core"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^2.5.0"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"><span class="pln">  </span><span class="str">"karma-chrome-launcher"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^2.0.0"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-python"><span class="pln">  </span><span class="str">"karma-jasmine"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^1.0.2"</span><span class="pun">,</span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="str">"karma"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^1.2.0"</span></code></li><li class="L5"><code class="language-python"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="xwgo">接下来通过npm install命令安装所有依赖，安装完毕后，我们就可以使用Jasmine框架编写测试用例代码了。（说明：以上操作不是必须的，也可以通过npm命令分别安装）</p><p data-anchor-id="1be5">例如，我们有一个方法用于从json字符串中过滤出Name和Id属性，代码如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="1waf"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="str">"jasmine-core"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^2.5.0"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"><span class="pln">  </span><span class="str">"karma-chrome-launcher"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^2.0.0"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-python"><span class="pln">  </span><span class="str">"karma-jasmine"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^1.0.2"</span><span class="pun">,</span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="str">"karma"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^1.2.0"</span></code></li><li class="L5"><code class="language-python"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="hdx5">测试用例编写完毕后，使用 <strong>Karma</strong> 工具来管理这些测试用例，通过 <strong>karma init</strong> 命令生成 <strong>Karma</strong> 配置文件。我们需要对 <strong>karma.conf.js</strong> 文件中的files属性进行修改，增加需要测试的JavaScript文件以及测试用例文件，例如：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="vl3s"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">files</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="str">"lib/normalize.js"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"><span class="pln">  </span><span class="str">"test/normalize.js"</span></code></li><li class="L3"><code class="language-python"><span class="pun">]</span></code></li></ol></pre><p data-anchor-id="25zo">需要注意的是，<strong>Karma</strong> 配置文件支持通配符，当同一目录下有多个JavaScript文件或测试用例文件时，可以使用通配符匹配所有文件，例如：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="pakx"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">files</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="str">"lib/*.js"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"><span class="pln">  </span><span class="str">"test/*.js"</span></code></li><li class="L3"><code class="language-python"><span class="pun">]</span></code></li></ol></pre><p data-anchor-id="ddlk">最后，通过 <strong>karma start</strong> 命令运行所有测试用例即可。在控制台会输出测试结果，例如本案例的结果如下：</p><p data-anchor-id="q72s"><img src="http://static.zybuluo.com/Iamxiaozhu/5u9sa8tdez89yx9keb7buqbp/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20170807174319.png" alt="微信截图_20170807174319.png-33.3kB" title=""></p><p data-anchor-id="0x1k">从控制台中的日志信息可知，下面两条断言表达式的值不符合预期结果：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="f2no"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">expect</span><span class="pun">(</span><span class="pln">norm2</span><span class="pun">.</span><span class="pln">name</span><span class="pun">).</span><span class="pln">toEqual</span><span class="pun">(</span><span class="str">"Maria"</span><span class="pun">);</span></code></li><li class="L1"><code class="language-python"><span class="pln">expect</span><span class="pun">(</span><span class="pln">norm2</span><span class="pun">.</span><span class="pln">id</span><span class="pun">).</span><span class="pln">toEqual</span><span class="pun">(</span><span class="lit">2111858</span><span class="pun">);</span></code></li></ol></pre><div class="md-section-divider"></div><h1 data-anchor-id="bbdx" id="angularjs单元测试">AngularJs单元测试</h1><hr><p data-anchor-id="qr4e">前面我们学习了目前主流的JavaScript代码测试框架 <strong>Jasmine</strong> 及测试管理工具 <strong>Karma</strong> 的使用方法，接下来开始学习如何使用 <strong>Jasmine</strong> 和 <strong>Karma</strong> 对 <strong>AngularJs</strong> 代码进行单元测试。需要注意的是，由于 <strong>AngularJs</strong> 框架自身的原因，对象是以依赖注入的方式加载和实例化。为了便于开发人员使用第三方测试框架（例如 <strong>Jasmine</strong>）对代码进行单元测试，<strong>AngularJS</strong> 官方提供了一个 <strong>ngMock</strong> 模块。该模块是一个单独的项目，我们可以使用 <strong>ngMock</strong> 模块简化 <strong>AngularJS</strong> 单元测试过程。</p><div class="md-section-divider"></div><h2 data-anchor-id="7nrj" id="搭建angularjs单元测试环境">搭建AngularJs单元测试环境</h2><p data-anchor-id="mm7w">打开控制台，进入项目根目录，通过npm init命令初始化项目，接着在生成的package.json文件的dependencies属性中添加项目依赖，如下面所示：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="u2z2"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"test"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"><span class="pln">  </span><span class="str">"version"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1.0.0"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-python"><span class="pln">  </span><span class="str">"description"</span><span class="pun">:</span><span class="pln"> </span><span class="str">""</span><span class="pun">,</span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="str">"main"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"index.js"</span><span class="pun">,</span></code></li><li class="L5"><code class="language-python"><span class="pln">  </span><span class="str">"scripts"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="language-python"><span class="pln">    </span><span class="str">"test"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></code></li><li class="L7"><code class="language-python"><span class="pln">  </span><span class="pun">},</span></code></li><li class="L8"><code class="language-python"><span class="pln">  </span><span class="str">"dependencies"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-python"><span class="pln">    </span><span class="str">"jasmine-core"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^2.5.0"</span><span class="pun">,</span></code></li><li class="L0"><code class="language-python"><span class="pln">    </span><span class="str">"karma-chrome-launcher"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^2.0.0"</span><span class="pun">,</span></code></li><li class="L1"><code class="language-python"><span class="pln">    </span><span class="str">"karma-jasmine"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^1.0.2"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"><span class="pln">    </span><span class="str">"karma"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^1.2.0"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-python"><span class="pln">    </span><span class="str">"angular"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^1.5.5"</span><span class="pun">,</span></code></li><li class="L4"><code class="language-python"><span class="pln">    </span><span class="str">"angular-mocks"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"^1.5.5"</span></code></li><li class="L5"><code class="language-python"><span class="pln">  </span><span class="pun">},</span></code></li><li class="L6"><code class="language-python"><span class="pln">  </span><span class="str">"author"</span><span class="pun">:</span><span class="pln"> </span><span class="str">""</span><span class="pun">,</span></code></li><li class="L7"><code class="language-python"><span class="pln">  </span><span class="str">"license"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"ISC"</span></code></li><li class="L8"><code class="language-python"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="reu5">需要注意的是，除了添加 <strong>Jasmine</strong> 和 <strong>Karma</strong> 模块外，本案例中需要的 <strong>AngularJs</strong> 库文件以及 <strong>ngMock</strong> 模块库文件都通过Npm获取，添加依赖后，通过 <strong>npm install</strong> 命令安装所有依赖。</p><p data-anchor-id="iodw">接下来执行 <strong>karma init</strong> 命令初始化 <strong>Karma</strong> 配置，我们对 <strong>karma.conf.js</strong> 文件中的files属性进行修改，增加如下内容： <br>
（如果无法执行是因为没有安装Karma命令行工具，请先执行"npm install -g karma-cli"）</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="bq9l"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">files</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L1"><code class="language-python"><span class="pln">  </span><span class="str">"node_modules/angular/angular.js"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"><span class="pln">  </span><span class="str">"node_modules/angular-mocks/angular-mocks.js"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-python"><span class="pln">  </span><span class="str">"src/*.js"</span><span class="pun">,</span></code></li><li class="L4"><code class="language-python"><span class="pln">  </span><span class="str">"test/*.js"</span></code></li><li class="L5"><code class="language-python"><span class="pun">]</span></code></li></ol></pre><p data-anchor-id="rmwb">由于是对 <strong>AngularJs</strong> 代码进行单元测试，因此所有 <strong>AngularJs</strong> 库文件和 <strong>ngMock</strong> 库文件是必不可少的，必须添加到 <strong>Karma</strong> 配置文件的files属性中。</p><div class="md-section-divider"></div><h2 data-anchor-id="jxhc" id="控制器单元测试">控制器单元测试</h2><p data-anchor-id="d524">接下来我们可以使用 <strong>Jasmine</strong> 和 <strong>Karma</strong> 对 <strong>AngularJS</strong> 应用中的控制器进行单元测试。假设我们有这样一个 <strong>AngularJS</strong> 应用，根据商品的价格和数量计算商品的总价，代码如下（src\test.html）：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="m260"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">&lt;!</span><span class="pln">DOCTYPE html</span><span class="pun">&gt;</span></code></li><li class="L1"><code class="language-python"><span class="pun">&lt;</span><span class="pln">html ng</span><span class="pun">-</span><span class="pln">app</span><span class="pun">=</span><span class="str">"myApp"</span><span class="pun">&gt;</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"><span class="pun">&lt;</span><span class="pln">head</span><span class="pun">&gt;</span></code></li><li class="L4"><code class="language-python"><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">meta charset</span><span class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">&gt;</span></code></li><li class="L5"><code class="language-python"><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">title</span><span class="pun">&gt;</span><span class="typ">Document</span><span class="pun">&lt;/</span><span class="pln">title</span><span class="pun">&gt;</span></code></li><li class="L6"><code class="language-python"><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">script src</span><span class="pun">=</span><span class="str">"../node_modules/angular/angular.js"</span><span class="pun">&gt;&lt;/</span><span class="pln">script</span><span class="pun">&gt;</span></code></li><li class="L7"><code class="language-python"><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">script src</span><span class="pun">=</span><span class="str">"../src/controller.js"</span><span class="pun">&gt;&lt;/</span><span class="pln">script</span><span class="pun">&gt;</span></code></li><li class="L8"><code class="language-python"><span class="pun">&lt;/</span><span class="pln">head</span><span class="pun">&gt;</span></code></li><li class="L9"><code class="language-python"></code></li><li class="L0"><code class="language-python"><span class="pun">&lt;</span><span class="pln">body ng</span><span class="pun">-</span><span class="pln">controller</span><span class="pun">=</span><span class="str">"MainController"</span><span class="pun">&gt;</span></code></li><li class="L1"><code class="language-python"><span class="pln">    </span><span class="pun">单价：&lt;</span><span class="pln">input type</span><span class="pun">=</span><span class="str">"number"</span><span class="pln"> ng</span><span class="pun">-</span><span class="pln">model</span><span class="pun">=</span><span class="str">"price"</span><span class="pun">&gt;&lt;</span><span class="pln">br</span><span class="pun">&gt;&lt;</span><span class="pln">br</span><span class="pun">&gt;</span></code></li><li class="L2"><code class="language-python"><span class="pln">    </span><span class="pun">数量：&lt;</span><span class="pln">input type</span><span class="pun">=</span><span class="str">"number"</span><span class="pln"> ng</span><span class="pun">-</span><span class="pln">model</span><span class="pun">=</span><span class="str">"num"</span><span class="pun">&gt;&lt;</span><span class="pln">br</span><span class="pun">&gt;&lt;</span><span class="pln">br</span><span class="pun">&gt;</span></code></li><li class="L3"><code class="language-python"><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">button ng</span><span class="pun">-</span><span class="pln">click</span><span class="pun">=</span><span class="str">"calculate()"</span><span class="pun">&gt;计算&lt;/</span><span class="pln">button</span><span class="pun">&gt;&lt;</span><span class="pln">br</span><span class="pun">&gt;</span></code></li><li class="L4"><code class="language-python"><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">p</span><span class="pun">&gt;总价：{{</span><span class="pln">total</span><span class="pun">}}&lt;/</span><span class="pln">p</span><span class="pun">&gt;</span></code></li><li class="L5"><code class="language-python"><span class="pun">&lt;/</span><span class="pln">body</span><span class="pun">&gt;</span></code></li><li class="L6"><code class="language-python"></code></li><li class="L7"><code class="language-python"><span class="pun">&lt;/</span><span class="pln">html</span><span class="pun">&gt;</span></code></li></ol></pre><p data-anchor-id="06l1">这个案例非常简单，不做过多说明，控制器MainController代码如下（src\controller.js）：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="1tf7"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">var app </span><span class="pun">=</span><span class="pln"> angular</span><span class="pun">.</span><span class="pln">module</span><span class="pun">(</span><span class="str">"myApp"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[]);</span></code></li><li class="L1"><code class="language-python"><span class="pln">app</span><span class="pun">.</span><span class="pln">controller</span><span class="pun">(</span><span class="str">"MainController"</span><span class="pun">,</span><span class="pln"> function </span><span class="pun">(</span><span class="pln">$scope</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-python"><span class="pln">    $scope</span><span class="pun">.</span><span class="pln">calculate </span><span class="pun">=</span><span class="pln"> function </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="language-python"><span class="pln">        $scope</span><span class="pun">.</span><span class="pln">total </span><span class="pun">=</span><span class="pln"> $scope</span><span class="pun">.</span><span class="pln">price </span><span class="pun">*</span><span class="pln"> $scope</span><span class="pun">.</span><span class="pln">num</span><span class="pun">;</span></code></li><li class="L4"><code class="language-python"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code class="language-python"><span class="pun">});</span></code></li></ol></pre><p data-anchor-id="rvys">然后我们可以使用 <strong>Jasmine</strong> 框架结合 <strong>AngularJS</strong> 的 <strong>ngMock</strong> 模块编写 <strong>AngularJS</strong> 控制器测试用例，代码如下（test\controller-spec.js）：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="qj6f"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">describe</span><span class="pun">(</span><span class="str">"MainController"</span><span class="pun">,</span><span class="pln"> function </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">    var $rootScope</span><span class="pun">,</span></code></li><li class="L2"><code class="language-python"><span class="pln">        scope</span><span class="pun">,</span></code></li><li class="L3"><code class="language-python"><span class="pln">        controller</span><span class="pun">;</span></code></li><li class="L4"><code class="language-python"></code></li><li class="L5"><code class="language-python"><span class="pln">    beforeEach</span><span class="pun">(</span><span class="pln">function </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="language-python"><span class="pln">        module</span><span class="pun">(</span><span class="str">"myApp"</span><span class="pun">);</span></code></li><li class="L7"><code class="language-python"><span class="pln">        inject</span><span class="pun">(</span><span class="pln">function </span><span class="pun">(</span><span class="pln">$injector</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="language-python"><span class="pln">            </span><span class="pun">//获取根作用域对象</span><span class="pln">$rootScope</span></code></li><li class="L9"><code class="language-python"><span class="pln">            $rootScope </span><span class="pun">=</span><span class="pln"> $injector</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="str">"$rootScope"</span><span class="pun">);</span></code></li><li class="L0"><code class="language-python"></code></li><li class="L1"><code class="language-python"><span class="pln">            </span><span class="pun">//使用</span><span class="pln">$rootScope</span><span class="pun">.</span><span class="pln">$new</span><span class="pun">()方法创建子作用域对象</span></code></li><li class="L2"><code class="language-python"><span class="pln">            scope </span><span class="pun">=</span><span class="pln"> $rootScope</span><span class="pun">.</span><span class="pln">$new</span><span class="pun">();</span></code></li><li class="L3"><code class="language-python"></code></li><li class="L4"><code class="language-python"><span class="pln">            </span><span class="pun">//获取</span><span class="pln">$controller</span><span class="pun">对象</span></code></li><li class="L5"><code class="language-python"><span class="pln">            var $controller </span><span class="pun">=</span><span class="pln"> $injector</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="str">"$controller"</span><span class="pun">);</span></code></li><li class="L6"><code class="language-python"></code></li><li class="L7"><code class="language-python"><span class="pln">            </span><span class="pun">//使用</span><span class="pln">$contorller</span><span class="pun">实例化</span><span class="typ">MainController</span></code></li><li class="L8"><code class="language-python"><span class="pln">            controller </span><span class="pun">=</span><span class="pln"> $controller</span><span class="pun">(</span><span class="str">"MainController"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-python"><span class="pln">                </span><span class="str">'$scope'</span><span class="pun">:</span><span class="pln"> scope</span></code></li><li class="L0"><code class="language-python"><span class="pln">            </span><span class="pun">});</span></code></li><li class="L1"><code class="language-python"><span class="pln">        </span><span class="pun">});</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"><span class="pln">        </span><span class="pun">//初始化作用域模型数据</span></code></li><li class="L4"><code class="language-python"><span class="pln">        scope</span><span class="pun">.</span><span class="pln">price </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10.2</span><span class="pun">;</span></code></li><li class="L5"><code class="language-python"><span class="pln">        scope</span><span class="pun">.</span><span class="pln">num </span><span class="pun">=</span><span class="pln"> </span><span class="lit">20</span><span class="pun">;</span></code></li><li class="L6"><code class="language-python"><span class="pln">    </span><span class="pun">});</span></code></li><li class="L7"><code class="language-python"></code></li><li class="L8"><code class="language-python"><span class="pln">    it</span><span class="pun">(</span><span class="str">"Test calculate function"</span><span class="pun">,</span><span class="pln"> function </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-python"><span class="pln">        scope</span><span class="pun">.</span><span class="pln">calculate</span><span class="pun">();</span></code></li><li class="L0"><code class="language-python"><span class="pln">        expect</span><span class="pun">(</span><span class="pln">scope</span><span class="pun">.</span><span class="pln">total</span><span class="pun">).</span><span class="pln">toEqual</span><span class="pun">(</span><span class="lit">204</span><span class="pun">);</span></code></li><li class="L1"><code class="language-python"><span class="pln">    </span><span class="pun">});</span></code></li><li class="L2"><code class="language-python"><span class="pun">})</span></code></li></ol></pre><p data-anchor-id="n6md">如上面的代码所示，module(string)和inject(function)方法是 <strong>ngMock</strong> 模块中提供两个全局方法</p><ol data-anchor-id="hpsj">
<li>module(string)方法接收一个字符串作为参数，用于指定需要测试的控制器所在的模块名称</li>
<li>inject(string)方法的参数是一个方法，用于在测试用例中以依赖注入的形式访问 <strong>AngularJS</strong> 内置的服务，例如<span>$</span>log、<span>$</span>http等。在上面的案例中，我们注入了 <strong>AngularJS</strong> 内置的<span>$</span>injector对象，<span>$</span>injector对象实际上就是一个IoC容器，可以通过<span>$</span>injector.get()方法获取 <strong>AngularJS</strong> 应用中的所有可注入对象。在上面的代码中，我们获取<span>$</span>rootScope对象和<span>$</span>controller对象，然后通过<span>$</span>rootScope.<span>$</span>new()方法创建一个子作用域对象，接着通过<span>$</span>controller对象来实例化MainController。</li>
</ol><p data-anchor-id="bcuz">最后，我们可以通过 <strong>karma start</strong> 命令来运行所有测试用例。</p><p data-anchor-id="utiz">结果如图所示：</p><p data-anchor-id="3l5t"><img src="http://static.zybuluo.com/Iamxiaozhu/dk544gv3pbr26czgxuqav4r8/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20170808112254.png" alt="微信截图_20170808112254.png-25.9kB" title=""></p><div class="md-section-divider"></div><h2 data-anchor-id="4toe" id="angularjs指令单元测试">AngularJS指令单元测试</h2><p data-anchor-id="i5tc">了解 <strong>AngularJS</strong> 控制器单元测试步骤后，我们再来学习 <strong>AngularJS</strong> 指令的单元测试方法。代码如下（src\directive.js）：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="f99j"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">app</span><span class="pun">.</span><span class="pln">directive</span><span class="pun">(</span><span class="str">"sayHello"</span><span class="pun">,</span><span class="pln"> function </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-python"><span class="pln">        restrict</span><span class="pun">:</span><span class="pln"> </span><span class="str">'E'</span><span class="pun">,</span></code></li><li class="L3"><code class="language-python"><span class="pln">        scope</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-python"><span class="pln">            name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'@nameAttr'</span></code></li><li class="L5"><code class="language-python"><span class="pln">        </span><span class="pun">},</span></code></li><li class="L6"><code class="language-python"><span class="pln">        template</span><span class="pun">:</span><span class="pln"> </span><span class="str">"&lt;h3&gt;hello,{{name}}&lt;/h3&gt;"</span></code></li><li class="L7"><code class="language-python"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code class="language-python"><span class="pun">});</span></code></li></ol></pre><p data-anchor-id="exbj">如上面的代码所示，该指令可接收一个name-attr参数，使用方法如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="bz9z"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pun">&lt;</span><span class="pln">say</span><span class="pun">-</span><span class="typ">Hello</span><span class="pln"> name</span><span class="pun">-</span><span class="pln">attr</span><span class="pun">=</span><span class="str">"Smith"</span><span class="pun">&gt;&lt;/</span><span class="pln">say</span><span class="pun">-</span><span class="typ">Hello</span><span class="pun">&gt;</span></code></li></ol></pre><p data-anchor-id="ywex">接下来我们可以使用 <strong>Jasmine</strong> 框架和 <strong>ngMock</strong> 模块编写指令单元测试代码，代码如下（test\directive-spec.js）：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="60q7"><ol class="linenums"><li class="L0"><code class="language-python"><span class="pln">describe</span><span class="pun">(</span><span class="str">'directive test'</span><span class="pun">,</span><span class="pln"> function </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-python"><span class="pln">    var elm</span><span class="pun">,</span><span class="pln"> scope</span><span class="pun">;</span></code></li><li class="L2"><code class="language-python"></code></li><li class="L3"><code class="language-python"><span class="pln">    beforeEach</span><span class="pun">(</span><span class="pln">module</span><span class="pun">(</span><span class="str">'myApp'</span><span class="pun">));</span></code></li><li class="L4"><code class="language-python"></code></li><li class="L5"><code class="language-python"><span class="pln">    beforeEach</span><span class="pun">(</span><span class="pln">inject</span><span class="pun">(</span><span class="pln">function </span><span class="pun">(</span><span class="pln">$rootScope</span><span class="pun">,</span><span class="pln"> $compile</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="language-python"><span class="pln">        elm </span><span class="pun">=</span><span class="pln"> angular</span><span class="pun">.</span><span class="pln">element</span><span class="pun">(</span><span class="str">'&lt;say-hello name-attr="Smith"&gt;&lt;/hello-world&gt;'</span><span class="pun">);</span></code></li><li class="L7"><code class="language-python"><span class="pln">        scope </span><span class="pun">=</span><span class="pln"> $rootScope</span><span class="pun">.</span><span class="pln">$new</span><span class="pun">();</span></code></li><li class="L8"><code class="language-python"><span class="pln">        $compile</span><span class="pun">(</span><span class="pln">elm</span><span class="pun">)(</span><span class="pln">scope</span><span class="pun">);</span></code></li><li class="L9"><code class="language-python"><span class="pln">        scope</span><span class="pun">.</span><span class="pln">$digest</span><span class="pun">();</span></code></li><li class="L0"><code class="language-python"><span class="pln">    </span><span class="pun">}));</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="pln">    it</span><span class="pun">(</span><span class="str">'sayHello directive test'</span><span class="pun">,</span><span class="pln"> function </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="language-python"><span class="pln">        expect</span><span class="pun">(</span><span class="pln">elm</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">'name-attr'</span><span class="pun">)).</span><span class="pln">toBe</span><span class="pun">(</span><span class="str">"Smith"</span><span class="pun">);</span></code></li><li class="L4"><code class="language-python"><span class="pln">        expect</span><span class="pun">(</span><span class="pln">elm</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()).</span><span class="pln">toBe</span><span class="pun">(</span><span class="str">"hello,Smith"</span><span class="pun">);</span></code></li><li class="L5"><code class="language-python"><span class="pln">    </span><span class="pun">})</span></code></li><li class="L6"><code class="language-python"><span class="pun">})</span></code></li></ol></pre><p data-anchor-id="sqmi">如上面的代码所示，angular.element()方法用于将HTML字符串或者DOM元素转换为jqLite（或者JQuery）对象。接着我们通过 <strong>ngMock</strong> 模块提供的inject()方法注入 <strong>AngularJS</strong> 内置的<span>$</span>compile服务。该服务的作用是编译一段HTML字符串或模板中的DOM元素，产生一个将作用域和模块链接的方法。简而言之，<span>$</span>compile服务的作用就是用于编译 <strong>AngularJS</strong> 指令，将指令替换为指令模板内容，然后将指令模板中的表达式替换为作用域中的值。</p><p data-anchor-id="9fct">在上面的代码中，我们使用<span>$</span>compile服务对自定义的sayHello指令进行编译，然后调用scope.<span>$</span>digest()方法触发Digest循环，指令编译后的内容为：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="flh8"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;h3</span><span class="pln"> </span><span class="atn">name-attr</span><span class="pun">=</span><span class="atv">"Smith"</span><span class="tag">&gt;</span><span class="pln">hello,Smith</span><span class="tag">&lt;/h3&gt;</span></code></li></ol></pre><p data-anchor-id="6oio">我们通过 <strong>Jasmine</strong> 框架的断言表达式语法判断指令编译后的内容是否满足预期要求，例如：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="fos7"><ol class="linenums"><li class="L0"><code><span class="pln">expect</span><span class="pun">(</span><span class="pln">elm</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">'name-attr'</span><span class="pun">)).</span><span class="pln">toBe</span><span class="pun">(</span><span class="str">"Smith"</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">expect</span><span class="pun">(</span><span class="pln">elm</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()).</span><span class="pln">toBe</span><span class="pun">(</span><span class="str">"hello,Smith"</span><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="0zc1">最后可以通过 <strong>karma start</strong> 命令运行所有单元测试用例，然后分析运行结果。</p><div class="md-section-divider"></div><h2 data-anchor-id="c1in" id="angularjs服务测试">AngularJS服务测试</h2><p data-anchor-id="mdef">下面我们再来学习一下AngularJS服务的单元测试。首先我们自定义一个AngularJS服务，代码如下（src\service.js）：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ea8d"><ol class="linenums"><li class="L0"><code><span class="pln">app</span><span class="pun">.</span><span class="pln">service</span><span class="pun">(</span><span class="str">'sayHello'</span><span class="pun">,</span><span class="kwd">function</span><span class="pun">(){</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">greeting</span><span class="pun">=</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">name</span><span class="pun">){</span></code></li><li class="L2"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"Hello "</span><span class="pun">+</span><span class="pln">name</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4"><code><span class="pun">})</span></code></li></ol></pre><p data-anchor-id="gt8k">如上面的代码所示，本案例中我们自定义了一个名称为sayHello的服务，该服务只有一个greeting()方法，返回一段字符串。接下来编写测试用例，代码如下（test\service-spec.js）：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="34og"><ol class="linenums"><li class="L0"><code><span class="pln">describe</span><span class="pun">(</span><span class="str">'service test'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    beforeEach</span><span class="pun">(</span><span class="kwd">module</span><span class="pun">(</span><span class="str">'myApp'</span><span class="pun">));</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    beforeEach</span><span class="pun">(</span><span class="pln">inject</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$rootScope</span><span class="pun">,</span><span class="pln"> $compile</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">        elm </span><span class="pun">=</span><span class="pln"> angular</span><span class="pun">.</span><span class="pln">element</span><span class="pun">(</span><span class="str">'&lt;say-hello name-attr="Smith"&gt;&lt;/hello-world&gt;'</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">        scope </span><span class="pun">=</span><span class="pln"> $rootScope</span><span class="pun">.</span><span class="pln">$new</span><span class="pun">();</span></code></li><li class="L6"><code><span class="pln">        $compile</span><span class="pun">(</span><span class="pln">elm</span><span class="pun">)(</span><span class="pln">scope</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">        scope</span><span class="pun">.</span><span class="pln">$digest</span><span class="pun">();</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}));</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    it</span><span class="pun">(</span><span class="str">'sayHello service test'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">        inject</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sayHello</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">            </span><span class="kwd">var</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> sayHello</span><span class="pun">.</span><span class="pln">greeting</span><span class="pun">(</span><span class="str">"Smith"</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">            expect</span><span class="pun">(</span><span class="pln">result</span><span class="pun">).</span><span class="pln">toBe</span><span class="pun">(</span><span class="str">"Hello Smith"</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">});</span></code></li><li class="L6"><code><span class="pun">});</span></code></li></ol></pre><p data-anchor-id="ra40">如上面的代码所示，<strong>AngularJS</strong> 服务的单元测试相对简单，因为 <strong>AngularJS</strong> 中的Service、Provider、Factory等服务都为可注入类型，我们只需要调用 <strong>ngMock</strong> 模块提供的全局方法inject(function)，然后将自定义服务注入即可，例如</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="5ei7"><ol class="linenums"><li class="L0"><code><span class="pln">inject</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">sayHello</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">            </span><span class="kwd">var</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> sayHello</span><span class="pun">.</span><span class="pln">greeting</span><span class="pun">(</span><span class="str">"Smith"</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">            expect</span><span class="pun">(</span><span class="pln">result</span><span class="pun">).</span><span class="pln">toBe</span><span class="pun">(</span><span class="str">"Hello Smith"</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">        </span><span class="pun">});</span></code></li></ol></pre><p data-anchor-id="yk2s">注入后就可以调用服务提供的方法对服务进行单元测试了。其他可注入类型，例如Provider、Factory等，单元测试方法与此相同，这里就不一一介绍了。</p><p data-anchor-id="gl9m"><code>单元测试</code></p></div>
</body>
</html>